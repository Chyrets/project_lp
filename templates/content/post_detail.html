{% extends 'base.html' %}
{% load humanize %}
{% load mptt_tags %}

{% block content %}
    <div class="mb-3">
        <h4>{{ post.title }}</h4>
    </div>
    <div class="mb-3">
        <a href="{% url 'content:profile_posts_list' post.author.slug %}" class="no_underline">{{ post.author }}</a>
        / {{ post.publication_date|naturaltime }}
        {% if post.changed %}
            / ред. {{ post.modification_date|naturaltime }}
        {% endif %}
    </div>
    <div class="mb-3">
        {% for tag in post.tags.all %}
            <a href="#" class="no_underline">{{ tag.title }}</a>
        {% endfor %}
    </div>
    {% if post.picture %}
        <div class="container d-flex align-items-center justify-content-center mb-3">>
            <img class="align-self-center" src="{{ post.picture.url }}" width="80%">
        </div>
    {% endif %}
    <div class="mb-3">
        {{ post.caption|linebreaks }}
    </div>
    <div class="mb-3">
        {{ post.views }} просмотров /
        <a class="no_underline link-primary" href="{% url 'content:post_reaction' post_id=post.pk reaction=1 %}">
            {{ likes }} лайков
        </a> /
        <a class="no_underline link-danger" href="{% url 'content:post_reaction' post_id=post.pk reaction=2 %}">
            {{ dislikes }} дизлайков
        </a> /
        {{ comments.count }} комментариев
    </div>
    <div>
        <form action="{% url 'content:add_comment' post.pk %}" method="POST">
            {% csrf_token %}
            <p>Добавить комментарий:</p>
            {% for field in form %}
                {{ field }}
                <div class="text-danger">{{ field.errors }}</div>
            {% endfor %}

            <button type="submit" class="btn btn-primary mt-2">Добавить</button>
        </form>
    </div>
    <div>
        <ul class="list-group list-group-flush">
            {% recursetree comments %}
                <li class="list-group-item">
                    <a class="no_underline link-primary"
                       href="{% url 'content:profile_posts_list' node.profile.slug %}">{{ node.profile }}
                    </a>
                    <small>{{ node.publication_date|naturaltime }}</small>
                    {% if node.changed %}
                        <small> / Изм. {{ node.modification_date|naturaltime }}</small>
                    {% endif %}
                    <p>{{ node.text }}</p>
                    {% if not node.is_leaf_comment %}
                        <ul class="list-group list-group-flush line">
                            {{ children }}
                        </ul>
                    {% endif %}
                </li>
            {% endrecursetree %}
        </ul>
    </div>
    {% if post.author.user == request.user %}
        <div class="'mb-3">
            <a href="{% url 'content:edit_post' post.pk %}" class="no_underline btn btn-success">Редактировать</a>
            <a href="{% url 'content:delete_post' post.pk %}" class="no_underline btn btn-danger">Удалить</a>
        </div>
    {% endif %}
{% endblock content %}